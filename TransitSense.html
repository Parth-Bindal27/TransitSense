<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TransitSense | Real-time Network Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.0/lucide.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');

        :root {
            --primary: #3b82f6;
            --primary-glow: rgba(59, 130, 246, 0.15);
            --transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Dynamic Theme System - BrainMirror Aesthetic */
        .dark-theme { 
            --bg: #050505; 
            --text: #fafafa; 
            --text-muted: rgba(250, 250, 250, 0.5);
            --card-bg: rgba(15, 15, 15, 0.6);
            --card-border: rgba(255, 255, 255, 0.04);
            --nav-bg: rgba(5, 5, 5, 0.7);
            --nav-border: rgba(255, 255, 255, 0.05);
            --accent: #3b82f6;
        }

        .light-theme { 
            --bg: #fcfcfc; 
            --text: #0a0a0a; 
            --text-muted: rgba(10, 10, 10, 0.5);
            --card-bg: rgba(255, 255, 255, 0.8);
            --card-border: rgba(0, 0, 0, 0.05);
            --nav-bg: rgba(252, 252, 252, 0.7);
            --nav-border: rgba(0, 0, 0, 0.05);
            --accent: #2563eb;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            transition: var(--transition);
        }

        .glass {
            background: var(--card-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--card-border);
        }

        /* Hero Spotlight Effect */
        .spotlight {
            position: absolute;
            top: 15%;
            left: 50%;
            transform: translateX(-50%);
            width: 60vw;
            height: 40vh;
            background: radial-gradient(circle, var(--primary-glow) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        /* Grainy Texture Layer */
        .noise {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0.02;
            z-index: 1;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        /* Navbar Refinement */
        #top-nav {
            background: transparent;
            border-bottom: 1px solid transparent;
            transition: var(--transition);
        }

        #top-nav.nav-blur {
            background: var(--nav-bg);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--nav-border);
            height: 72px;
        }

        /* Typography Scaling */
        h1 { line-height: 1.1; letter-spacing: -0.04em; }
        .hero-title { font-size: clamp(3rem, 7vw, 5.5rem); }
        .hero-sub { color: var(--text-muted); font-size: clamp(1rem, 1.5vw, 1.25rem); line-height: 1.6; max-width: 600px; }

        /* Animations */
        @keyframes reveal {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .reveal { animation: reveal 1s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
        .delay-1 { animation-delay: 0.2s; }
        .delay-2 { animation-delay: 0.4s; }

        /* Dash Styles */
        .tab-active { background: var(--accent); color: white; }
        .fleet-card { transition: all 0.3s ease; border-left: 0 solid transparent; }
        .fleet-card:hover { transform: translateX(4px); background: rgba(59, 130, 246, 0.05); }
        .fleet-card.selected { border-left: 4px solid var(--accent); background: rgba(59, 130, 246, 0.15); }

        .timeline-line {
            position: absolute; left: 24px; top: 0; bottom: 0; width: 2px;
            background: linear-gradient(to bottom, transparent, var(--accent), transparent); opacity: 0.3;
        }
        .stop-node { position: relative; z-index: 10; }
        .stop-active .node-circle { background: var(--accent); box-shadow: 0 0 15px var(--accent); transform: scale(1.2); }
    </style>
</head>
<body class="dark-theme overflow-hidden">

    <div class="noise"></div>

    <!-- Top Navigation Bar -->
    <nav id="top-nav" class="fixed top-0 left-0 w-full z-[100] flex items-center h-20">
        <div class="max-w-7xl mx-auto px-8 w-full flex items-center justify-between">
            <div class="flex items-center gap-2.5 cursor-pointer" onclick="setView('landing')">
                <div class="bg-blue-600 p-1.5 rounded-lg shadow-lg shadow-blue-500/20">
                    <i data-lucide="zap" class="text-white w-4 h-4"></i>
                </div>
                <span class="font-bold text-lg tracking-tight">TransitSense</span>
            </div>
            
            <div class="hidden md:flex items-center gap-10">
                <a href="#features" class="text-[13px] font-medium opacity-50 hover:opacity-100 transition-opacity">Features</a>
                <a href="#how-it-works" class="text-[13px] font-medium opacity-50 hover:opacity-100 transition-opacity">Methodology</a>
                <a href="#support" class="text-[13px] font-medium opacity-50 hover:opacity-100 transition-opacity">Support</a>
            </div>

            <div class="flex items-center gap-6">
                <button onclick="toggleTheme()" class="p-2 opacity-50 hover:opacity-100 transition-opacity">
                    <i data-lucide="moon" id="theme-icon-nav" class="w-4 h-4"></i>
                </button>
                <button onclick="setView('map')" class="bg-blue-600 text-white px-5 py-2.5 rounded-full text-[13px] font-semibold hover:bg-blue-500 transition-all shadow-lg shadow-blue-600/20">
                    Enter Dashboard
                </button>
            </div>
        </div>
    </nav>

    <!-- App Content Layout -->
    <div id="app" class="h-screen flex flex-col md:flex-row p-0 md:p-4 gap-4 overflow-hidden">
        
        <!-- Navigation Sidebar (Dashboard Only) -->
        <aside id="sidebar" class="hidden w-full md:w-64 flex-col gap-4 transition-all duration-500">
            <div class="glass rounded-[2rem] p-6 flex items-center justify-between">
                <div class="flex items-center gap-3 cursor-pointer" onclick="setView('landing')">
                    <div class="bg-blue-600 p-2 rounded-xl">
                        <i data-lucide="zap" class="text-white w-5 h-5"></i>
                    </div>
                    <div>
                        <h1 class="font-bold text-base tracking-tight">TransitSense</h1>
                        <p class="text-[9px] uppercase tracking-widest opacity-40">Network Intel</p>
                    </div>
                </div>
            </div>

            <nav class="glass rounded-[2rem] p-2.5 flex flex-col gap-1">
                <button onclick="setView('map')" id="tab-map" class="flex items-center gap-3 p-3.5 rounded-2xl transition-all opacity-60">
                    <i data-lucide="route" class="w-4 h-4"></i>
                    <span class="font-medium text-[13px]">Live Tracker</span>
                </button>
                <button onclick="setView('planner')" id="tab-planner" class="flex items-center gap-3 p-3.5 rounded-2xl transition-all opacity-60">
                    <i data-lucide="sparkles" class="w-4 h-4"></i>
                    <span class="font-medium text-[13px]">AI Route Planner</span>
                </button>
                <button onclick="setView('status')" id="tab-status" class="flex items-center gap-3 p-3.5 rounded-2xl transition-all opacity-60">
                    <i data-lucide="database" class="w-4 h-4"></i>
                    <span class="font-medium text-[13px]">System Flow</span>
                </button>
            </nav>

            <div class="glass bg-blue-500/[0.03] border-blue-500/10 rounded-[2rem] p-6 mt-auto">
                <div class="flex items-center gap-2 mb-3">
                    <div class="w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse"></div>
                    <span class="text-[10px] font-bold uppercase text-blue-400 tracking-wider">ETM Data Sync</span>
                </div>
                <h3 class="font-semibold text-xs mb-1">Fleet Intelligence</h3>
                <p class="text-[11px] opacity-40 leading-relaxed">Analyzing real-time ticketing transactions across the grid.</p>
            </div>
        </aside>

        <!-- Main Workspace -->
        <main class="flex-1 relative flex flex-col gap-4 overflow-hidden">
            
            <!-- VIEW: LANDING (BrainMirror Redesign) -->
            <div id="view-landing" class="h-screen overflow-y-auto scroll-smooth no-scrollbar" onscroll="handleNavScroll(this)">
                
                <!-- Hero Section -->
                <section class="min-h-screen flex flex-col items-center justify-center px-8 relative">
                    <div class="spotlight"></div>
                    
                    <div class="reveal max-w-4xl mx-auto space-y-10 text-center">
                        <div class="inline-flex items-center gap-2.5 px-4 py-1.5 rounded-full bg-blue-600/5 border border-blue-600/10 text-[11px] font-semibold uppercase tracking-wider text-blue-500">
                            Real-time Network Intelligence
                        </div>
                        
                        <h1 class="hero-title font-extrabold text-center mx-auto max-w-4xl">
                            See your commute <br/> 
                            <span class="opacity-50">before you board.</span>
                        </h1>
                        
                        <p class="hero-sub mx-auto">
                            Live crowd metrics and timing insights derived from verified ticketing transactions. Experience the clarity of a connected network.
                        </p>
                        
                        <div class="flex items-center justify-center gap-8 pt-4">
                            <button onclick="setView('map')" class="px-9 py-4 bg-blue-600 hover:bg-blue-500 text-white rounded-full font-bold shadow-2xl shadow-blue-600/20 transition-all hover:translate-y-[-2px]">
                                View Live Tracker
                            </button>
                            <a href="#how-it-works" class="text-sm font-semibold opacity-40 hover:opacity-100 transition-opacity flex items-center gap-2">
                                Methodology <i data-lucide="chevron-right" class="w-4 h-4"></i>
                            </a>
                        </div>
                    </div>
                </section>

                <!-- Features Section -->
                <section id="features" class="section-padding max-w-7xl mx-auto">
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="p-10 glass rounded-[2.5rem] space-y-6 hover:translate-y-[-4px] transition-all">
                            <div class="w-10 h-10 bg-blue-600/10 rounded-xl flex items-center justify-center">
                                <i data-lucide="users" class="text-blue-500 w-5 h-5"></i>
                            </div>
                            <h4 class="text-lg font-bold">Crowd Visibility</h4>
                            <p class="text-[13px] opacity-40 leading-relaxed">Precise occupancy levels derived from active gate and terminal telemetry.</p>
                        </div>
                        <div class="p-10 glass rounded-[2.5rem] space-y-6 hover:translate-y-[-4px] transition-all">
                            <div class="w-10 h-10 bg-blue-600/10 rounded-xl flex items-center justify-center">
                                <i data-lucide="timer" class="text-blue-500 w-5 h-5"></i>
                            </div>
                            <h4 class="text-lg font-bold">Verified Timing</h4>
                            <p class="text-[13px] opacity-40 leading-relaxed">Actual segment speeds calculated from ticket validation timestamps.</p>
                        </div>
                        <div class="p-10 glass rounded-[2.5rem] space-y-6 hover:translate-y-[-4px] transition-all">
                            <div class="w-10 h-10 bg-blue-600/10 rounded-xl flex items-center justify-center">
                                <i data-lucide="layers" class="text-blue-500 w-5 h-5"></i>
                            </div>
                            <h4 class="text-lg font-bold">Station Tracking</h4>
                            <p class="text-[13px] opacity-40 leading-relaxed">Headcount monitoring across starting, intermediate, and terminal points.</p>
                        </div>
                        <div class="p-10 glass rounded-[2.5rem] space-y-6 hover:translate-y-[-4px] transition-all">
                            <div class="w-10 h-10 bg-blue-600/10 rounded-xl flex items-center justify-center">
                                <i data-lucide="compass" class="text-blue-500 w-5 h-5"></i>
                            </div>
                            <h4 class="text-lg font-bold">Optimal Choice</h4>
                            <p class="text-[13px] opacity-40 leading-relaxed">Ranking routes based on physical comfort scores and total exposure metrics.</p>
                        </div>
                    </div>
                </section>

                <!-- Methodology Section -->
                <section id="how-it-works" class="section-padding border-y border-white/[0.03]">
                    <div class="max-w-4xl mx-auto space-y-24">
                        <div class="text-center space-y-5">
                            <h2 class="text-4xl font-extrabold tracking-tight">The Transactional Loop</h2>
                            <p class="text-lg opacity-40 max-w-xl mx-auto">TransitSense integrates directly with core infrastructure to build a precise map of network load.</p>
                        </div>
                        
                        <div class="grid gap-20">
                            <div class="flex gap-10 items-start">
                                <div class="text-4xl font-bold text-blue-500 opacity-20 pt-1">01</div>
                                <div>
                                    <h5 class="text-2xl font-bold mb-3">Gateway Integration</h5>
                                    <p class="opacity-40 leading-relaxed text-lg">We capture headcount metrics from fare gates and bus ticketing machines (ETM) at the point of transaction.</p>
                                </div>
                            </div>
                            <div class="flex gap-10 items-start">
                                <div class="text-4xl font-bold text-blue-500 opacity-20 pt-1">02</div>
                                <div>
                                    <h5 class="text-2xl font-bold mb-3">Velocity Computation</h5>
                                    <p class="opacity-40 leading-relaxed text-lg">By analyzing sequence patterns, we derive actual route performance and predict arrival windows with certainty.</p>
                                </div>
                            </div>
                            <div class="flex gap-10 items-start">
                                <div class="text-4xl font-bold text-blue-500 opacity-20 pt-1">03</div>
                                <div>
                                    <h5 class="text-2xl font-bold mb-3">Informed Departure</h5>
                                    <p class="opacity-40 leading-relaxed text-lg">Insights are delivered as actionable comfort rankings, allowing you to choose the least congested path.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Support Section -->
                <section id="support" class="section-padding text-center">
                    <div class="max-w-4xl mx-auto space-y-16">
                        <div class="space-y-4">
                            <h2 class="text-4xl font-extrabold tracking-tight">Assisting your journey.</h2>
                            <p class="text-lg opacity-40">Our team is committed to helping commuters make informed travel decisions.</p>
                        </div>
                        
                        <div class="flex flex-col md:flex-row items-center justify-center gap-8">
                            <div class="p-8 glass rounded-[2.5rem] flex-1 text-left space-y-4 border-blue-500/10">
                                <h5 class="font-bold">Contact Support</h5>
                                <p class="text-[13px] opacity-40">Reach out for platform assistance or data integration queries.</p>
                                <a href="mailto:hello@transitsense.io" class="inline-block pt-2 font-bold text-blue-500">hello@transitsense.io</a>
                            </div>
                            <div class="p-8 glass rounded-[2.5rem] flex-1 text-left space-y-4 border-blue-500/10">
                                <h5 class="font-bold">Documentation</h5>
                                <p class="text-[13px] opacity-40">Learn more about our methodology and network coverage.</p>
                                <a href="#" class="inline-block pt-2 font-bold text-blue-500">Explore Guides</a>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Footer -->
                <footer class="p-12 mt-20 border-t border-white/[0.03] bg-[#020202]">
                    <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between gap-12">
                        <div class="space-y-4">
                            <div class="flex items-center gap-2.5">
                                <div class="bg-blue-600 p-1 rounded-lg">
                                    <i data-lucide="zap" class="text-white w-4 h-4"></i>
                                </div>
                                <span class="font-bold text-lg tracking-tight">TransitSense</span>
                            </div>
                            <p class="text-[11px] opacity-20 font-semibold tracking-widest uppercase">
                                © 2026 TransitSense Systems <br/>
                                Live Transactional Analytics
                            </p>
                        </div>
                        <div class="flex gap-16">
                            <div class="space-y-4 text-sm">
                                <h6 class="text-[11px] font-bold uppercase tracking-widest opacity-20">Platform</h6>
                                <nav class="flex flex-col gap-2.5 opacity-40">
                                    <a href="#" onclick="setView('map')">Tracker</a>
                                    <a href="#" onclick="setView('planner')">Planner</a>
                                    <a href="#" onclick="setView('status')">System Status</a>
                                </nav>
                            </div>
                            <div class="space-y-4 text-sm">
                                <h6 class="text-[11px] font-bold uppercase tracking-widest opacity-20">Legal</h6>
                                <nav class="flex flex-col gap-2.5 opacity-40">
                                    <a href="#">Privacy Policy</a>
                                    <a href="#">Network Terms</a>
                                </nav>
                            </div>
                        </div>
                    </div>
                    <p class="max-w-7xl mx-auto pt-16 text-[10px] opacity-10 italic">Disclaimer: Insights may include estimated or simulated values based on real-time transaction density signals across the public transport grid.</p>
                </footer>
            </div>

            <!-- VIEW: DASHBOARD - MAP TRACKER -->
            <div id="view-map" class="hidden flex-1 flex flex-col h-full animate-in slide-in-from-right duration-500 gap-4 p-4 md:p-0">
                <div class="glass rounded-[2rem] p-4 flex flex-wrap items-center justify-between gap-4">
                    <div class="flex items-center gap-4">
                        <select id="city-selector" onchange="changeCity(this.value)" class="bg-transparent border border-white/5 rounded-xl px-4 py-2 text-sm font-bold outline-none cursor-pointer">
                            <option value="bangalore">Bangalore</option>
                            <option value="mumbai">Mumbai</option>
                        </select>
                        <div class="flex gap-1 p-1 bg-white/5 rounded-xl">
                            <button onclick="changeMode('bus')" id="mode-bus" class="cat-tab px-4 py-1.5 rounded-lg text-[11px] font-bold active">Bus Fleet</button>
                            <button onclick="changeMode('metro')" id="mode-metro" class="cat-tab px-4 py-1.5 rounded-lg text-[11px] font-bold">Metro Units</button>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 px-3 py-1 rounded-full bg-blue-500/10 border border-blue-500/20">
                         <div class="w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse"></div>
                         <span class="text-[9px] font-bold uppercase text-blue-400">Sync Active</span>
                    </div>
                </div>

                <div class="flex-1 flex flex-col lg:flex-row gap-4 min-h-0">
                    <div class="w-full lg:w-80 flex flex-col gap-3 glass rounded-[2rem] p-5 overflow-hidden">
                        <h4 class="text-[10px] font-bold uppercase tracking-widest opacity-30 px-1">Live Fleet Load</h4>
                        <div id="vehicle-list" class="flex-1 overflow-y-auto space-y-2 pr-1"></div>
                    </div>

                    <div class="flex-1 glass rounded-[2rem] flex flex-col overflow-hidden">
                        <div class="p-6 border-b border-white/5 flex justify-between items-center bg-white/[0.02]">
                            <div id="timeline-header-info">
                                <h2 class="text-xl font-bold" id="current-v-name">Select a Vehicle</h2>
                                <p class="text-xs opacity-40" id="current-v-id">Tracking transactional passenger load</p>
                            </div>
                            <div id="v-stats" class="hidden flex gap-6">
                                <div class="text-center"><p class="text-[10px] uppercase font-bold opacity-30">Load</p><p class="text-sm font-bold" id="v-load">0/0</p></div>
                                <div class="text-center"><p class="text-[10px] uppercase font-bold opacity-30">Seats</p><p class="text-sm font-bold text-blue-500" id="v-seats">0</p></div>
                            </div>
                        </div>
                        <div class="flex-1 overflow-y-auto p-8 relative" id="timeline-content">
                            <div id="timeline-empty" class="h-full flex flex-col items-center justify-center opacity-20">
                                <i data-lucide="mouse-pointer-2" class="w-10 h-10 mb-4"></i>
                                <p class="text-sm">Select a vehicle from the sidebar to view stop details.</p>
                            </div>
                            <div id="timeline-container" class="hidden relative pl-12 space-y-12"><div class="timeline-line"></div></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: DASHBOARD - AI TRIP PLANNER -->
            <div id="view-planner" class="hidden flex-1 flex flex-col gap-6 p-4 md:p-0 max-w-5xl mx-auto w-full animate-in slide-in-from-bottom duration-700 overflow-hidden">
                <div class="text-center mb-2">
                    <h2 class="text-3xl font-extrabold mb-1">Route Planning</h2>
                    <p class="opacity-40 text-xs">Comparing route efficiency based on crowd exposure weights.</p>
                </div>
                
                <div class="grid md:grid-cols-5 gap-6 pt-4 flex-1 min-h-0">
                    <div class="md:col-span-2 glass rounded-[2.5rem] p-7 space-y-5 h-fit shadow-xl">
                        <div>
                            <label class="text-[10px] uppercase font-bold opacity-30 ml-2">Current City</label>
                            <input list="indian-cities" id="planner-city" class="w-full bg-white/5 p-3.5 rounded-2xl border border-white/5 outline-none text-[13px] font-medium" placeholder="Select City...">
                            <datalist id="indian-cities">
                                <option value="Bangalore"><option value="Mumbai"><option value="Delhi"><option value="Hyderabad"><option value="Chennai"><option value="Kolkata"><option value="Pune"><option value="Jaipur">
                            </datalist>
                        </div>
                        <div>
                            <label class="text-[10px] uppercase font-bold opacity-30 ml-2">Starting Point</label>
                            <input type="text" id="planner-source" placeholder="Your location" class="w-full bg-white/5 p-3.5 rounded-2xl border border-white/5 outline-none text-[13px] mt-1">
                        </div>
                        <div>
                            <label class="text-[10px] uppercase font-bold opacity-30 ml-2">Destination</label>
                            <input type="text" id="planner-dest" placeholder="Where to?" class="w-full bg-white/5 p-3.5 rounded-2xl border border-white/5 outline-none text-[13px] mt-1">
                        </div>
                        <div class="p-3.5 bg-blue-600/5 rounded-2xl border border-blue-600/10 flex items-center justify-between">
                            <span class="text-[10px] font-bold opacity-30 uppercase">Local Time</span>
                            <span id="planner-clock" class="text-sm font-mono font-bold text-blue-500">22:30</span>
                        </div>
                        <button onclick="calculateTrip()" class="w-full bg-blue-600 py-4 rounded-2xl font-bold hover:bg-blue-500 transition-all flex items-center justify-center gap-2 group">
                            <span>Analyze Routes</span><i data-lucide="zap" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <div id="planner-results" class="md:col-span-3 overflow-y-auto pr-2 space-y-4">
                        <div class="h-full flex flex-col items-center justify-center opacity-10 text-center border-2 border-dashed border-white/5 rounded-[2.5rem] p-10">
                            <i data-lucide="map-pin" class="w-14 h-14 mb-6"></i>
                            <p class="text-sm font-medium leading-relaxed">Route optimization will appear here.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: DASHBOARD - SYSTEM STATUS -->
            <div id="view-status" class="hidden flex-1 flex flex-col items-center justify-center p-8 animate-in zoom-in duration-500">
                 <div class="glass rounded-[3rem] p-12 max-w-2xl w-full text-center">
                    <i data-lucide="database" class="w-16 h-16 text-blue-500 mx-auto mb-6"></i>
                    <h2 class="text-3xl font-extrabold mb-8">Data Stream Health</h2>
                    <div class="grid grid-cols-2 gap-6">
                        <div class="p-7 glass rounded-[2rem] border-green-500/10"><h4 class="text-2xl font-bold text-green-500">Active</h4><p class="text-[10px] uppercase font-bold opacity-30 mt-1">Metro Gates</p></div>
                        <div class="p-7 glass rounded-[2rem] border-blue-500/10"><h4 class="text-2xl font-bold text-blue-500">Synced</h4><p class="text-[10px] uppercase font-bold opacity-30 mt-1">Fleet ETMs</p></div>
                    </div>
                 </div>
            </div>

        </main>
    </div>

    <script>
        // --- DATA ENGINE ---
        const cityData = {
            bangalore: { modes: ['bus', 'metro'], routes: { 
                bus: [{ id: 'b1', name: "500C (Marathahalli)", vid: "BMTC-582", cost: "₹18", pax: 18, cap: 40, seats: 22, current_stop: "Tin Factory", stops: [{ name: "Hebbal", type: "start", load: "Low", tickets: 12 },{ name: "Manyata Tech Park", type: "mid", load: "Medium", tickets: 24 },{ name: "Tin Factory", type: "mid", load: "Low", tickets: 6 },{ name: "Marathahalli Bridge", type: "mid", load: "High", tickets: 45 },{ name: "Central Board", type: "end", load: "Low", tickets: 0 }] }],
                metro: [{ id: 'm1', name: "Purple Line", vid: "BMRCL-102", cost: "₹45", pax: 482, cap: 500, seats: 18, current_stop: "Indiranagar", stops: [{ name: "Kengeri", type: "start", load: "Low", tickets: 45 },{ name: "Majestic Interchange", type: "mid", load: "High", tickets: 320 },{ name: "Whitefield", type: "end", load: "Low", tickets: 0 }] }]
            }},
            mumbai: { modes: ['bus'], routes: { 
                bus: [{ id: 'mb1', name: "BEST 121", vid: "BEST-49", cost: "₹5", pax: 8, cap: 42, seats: 34, current_stop: "Colaba", stops: [{ name: "CST Terminal", type: "start", load: "Medium", tickets: 15 },{ name: "Marine Drive", type: "end", load: "Low", tickets: 0 }] }]
            }}
        };

        const metroEnabledCities = ["Bangalore", "Mumbai", "Delhi", "Hyderabad", "Chennai", "Kolkata", "Pune", "Ahmedabad", "Lucknow", "Jaipur"];
        let state = { currentCity: 'bangalore', currentMode: 'bus', view: 'landing', selectedRouteId: null };

        function initIcons() { if (typeof lucide !== 'undefined') lucide.createIcons(); }

        window.onload = () => { initIcons(); setView('landing'); refreshCityUI(); updatePlannerClock(); setInterval(updatePlannerClock, 60000); };

        function updatePlannerClock() {
            const now = new Date();
            const timeStr = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
            const clockEl = document.getElementById('planner-clock');
            if (clockEl) clockEl.innerText = timeStr;
        }

        function handleNavScroll(el) {
            const nav = document.getElementById('top-nav');
            if (el.scrollTop > 50) { nav.classList.add('nav-blur'); } 
            else { nav.classList.remove('nav-blur'); }
        }

        function setView(view) {
            state.view = view;
            const views = ['landing', 'map', 'planner', 'status'];
            views.forEach(v => {
                const el = document.getElementById(`view-${v}`);
                if (el) el.classList.add('hidden');
            });
            const targetView = document.getElementById(`view-${view}`);
            if (targetView) targetView.classList.remove('hidden');

            const topNav = document.getElementById('top-nav');
            const sidebar = document.getElementById('sidebar');

            if(view === 'landing') {
                if (topNav) topNav.classList.remove('hidden');
                if (sidebar) sidebar.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            } else {
                if (topNav) topNav.classList.add('hidden');
                if (sidebar) sidebar.classList.remove('hidden');
                document.body.classList.add('overflow-hidden');
            }

            ['map', 'planner', 'status'].forEach(n => {
                const btn = document.getElementById(`tab-${n}`);
                if(btn) { btn.classList.remove('tab-active'); btn.classList.add('opacity-40'); }
            });
            const activeTab = document.getElementById(`tab-${view}`);
            if(activeTab) { activeTab.classList.add('tab-active'); activeTab.classList.remove('opacity-40'); }
            initIcons();
        }

        function refreshCityUI() {
            updateTransportTabs();
            drawVehicleList();
        }

        function changeCity(city) {
            state.currentCity = city;
            state.selectedRouteId = null;
            if (!cityData[city].modes.includes(state.currentMode)) state.currentMode = cityData[city].modes[0];
            refreshCityUI();
            updateTimeline();
        }

        function changeMode(mode) {
            if (cityData[state.currentCity].modes.includes(mode)) {
                state.currentMode = mode; state.selectedRouteId = null; refreshCityUI(); updateTimeline();
            }
        }

        function updateTransportTabs() {
            const city = cityData[state.currentCity];
            ['bus', 'metro'].forEach(m => {
                const btn = document.getElementById(`mode-${m}`);
                if (btn) {
                    if (!city.modes.includes(m)) { btn.classList.add('disabled', 'opacity-20'); btn.classList.remove('active'); }
                    else { btn.classList.remove('disabled', 'opacity-20'); if (state.currentMode === m) btn.classList.add('active'); else btn.classList.remove('active'); }
                }
            });
        }

        function drawVehicleList() {
            const list = document.getElementById('vehicle-list');
            if (!list) return;
            list.innerHTML = '';
            const routes = cityData[state.currentCity].routes[state.currentMode] || [];
            routes.forEach(r => {
                const loadPercent = Math.min(Math.round((r.pax / r.cap) * 100), 100);
                const colorClass = r.pax / r.cap > 0.8 ? 'bg-red-500' : (r.pax / r.cap > 0.4 ? 'bg-yellow-500' : 'bg-blue-600');
                const card = document.createElement('div');
                card.className = `fleet-card glass p-4 rounded-2xl cursor-pointer ${state.selectedRouteId === r.id ? 'selected' : ''}`;
                card.onclick = () => selectRoute(r.id);
                card.innerHTML = `<div class="flex justify-between items-start mb-3"><div><p class="text-[9px] font-bold text-blue-500 mb-1 tracking-wider uppercase">${r.vid}</p><h5 class="text-[13px] font-bold leading-none">${r.name}</h5></div><span class="text-[10px] font-mono opacity-40">${r.cost}</span></div><div class="w-full bg-white/5 h-1 rounded-full overflow-hidden"><div class="${colorClass} h-full" style="width: ${loadPercent}%"></div></div><p class="text-[10px] opacity-30 mt-2 truncate">Current: ${r.current_stop}</p>`;
                list.appendChild(card);
            });
        }

        function selectRoute(id) { state.selectedRouteId = id; drawVehicleList(); updateTimeline(); }

        function updateTimeline() {
            const empty = document.getElementById('timeline-empty');
            const container = document.getElementById('timeline-container');
            const hName = document.getElementById('current-v-name');
            const hId = document.getElementById('current-v-id');
            const hStats = document.getElementById('v-stats');
            
            if (!state.selectedRouteId) {
                if(empty) empty.classList.remove('hidden');
                if(container) container.classList.add('hidden');
                hName.innerText = "Select a Vehicle"; hId.innerText = "Tracking transactional passenger load"; hStats.classList.add('hidden');
                return;
            }

            const route = (cityData[state.currentCity].routes[state.currentMode] || []).find(r => r.id === state.selectedRouteId);
            if (!route) return;

            if(empty) empty.classList.add('hidden');
            if(container) container.classList.remove('hidden');
            hName.innerText = route.name; hId.innerText = `ID: ${route.vid} • Real-time Transaction Sync`; hStats.classList.remove('hidden');
            document.getElementById('v-load').innerText = `${route.pax}/${route.cap}`;
            document.getElementById('v-seats').innerText = route.seats;

            container.innerHTML = '<div class="timeline-line"></div>';
            route.stops.forEach(stop => {
                const isActive = stop.name === route.current_stop;
                const loadColor = stop.load === 'High' ? 'text-red-400' : (stop.load === 'Medium' ? 'text-yellow-400' : 'text-blue-500');
                const stopDiv = document.createElement('div');
                stopDiv.className = `stop-node flex items-start gap-6 ${isActive ? 'stop-active' : ''}`;
                stopDiv.innerHTML = `<div class="relative mt-1.5"><div class="node-circle w-3 h-3 rounded-full border border-white/20 bg-slate-800 transition-all"></div></div><div class="flex-1 glass p-5 rounded-[1.5rem] border-white/5 transition-all ${isActive ? 'bg-blue-600/[0.03] border-blue-600/20' : ''}"><div class="flex justify-between items-start"><div><h4 class="font-bold text-[14px] ${isActive ? 'text-blue-500' : ''}">${stop.name}</h4><p class="text-[9px] uppercase font-bold tracking-widest opacity-20 mt-0.5">${stop.type}</p></div><div class="text-right"><span class="text-[9px] px-2 py-1 rounded-full font-black tracking-widest uppercase ${loadColor} bg-white/5">${stop.load} Load</span><p class="text-[9px] opacity-20 font-bold mt-1.5">${stop.tickets} TAPS</p></div></div></div>`;
                container.appendChild(stopDiv);
            });
            initIcons();
        }

        function calculateTrip() {
            const city = document.getElementById('planner-city').value;
            const res = document.getElementById('planner-results');
            res.innerHTML = `<div class="h-64 flex flex-col items-center justify-center animate-pulse"><i data-lucide="refresh-cw" class="w-8 h-8 text-blue-500 animate-spin mb-4"></i><p class="text-xs font-semibold opacity-30">Synchronizing Network Data...</p></div>`;
            initIcons();
            setTimeout(() => {
                const supportsMetro = metroEnabledCities.includes(city);
                const options = [
                    { type: 'Fastest', title: supportsMetro ? 'Metro Purple Line' : 'Express Route 1', segments: [{ duration: 18, crowd: 'High' }], cost: 45, color: 'red', reason: "Highest segment velocity. Significant physical load likely." },
                    { type: 'Most Comfortable', title: 'Premium Shuttle', segments: [{ duration: 27, crowd: 'Low' }], cost: 65, color: 'green', reason: "Minimum exposure score. High seating probability verified." },
                    { type: 'Balanced', title: 'Route Loop B', segments: [{ duration: 22, crowd: 'Medium' }], cost: 55, color: 'blue', reason: "Optimized ratio of speed vs. vehicle occupancy." }
                ];
                res.innerHTML = `<div class="space-y-4 animate-in slide-in-from-bottom duration-700">${options.map(opt => `
                    <div class="glass p-6 rounded-[2.5rem] relative overflow-hidden group hover:border-blue-500/20 transition-all">
                        <div class="absolute top-0 right-0 p-5"><span class="text-[9px] font-black uppercase tracking-widest px-3 py-1.5 rounded-full bg-white/5 opacity-50">${opt.type}</span></div>
                        <div class="flex items-center gap-4 mb-6">
                            <div class="w-11 h-11 rounded-xl bg-blue-600/5 flex items-center justify-center"><i data-lucide="navigation-2" class="w-5 h-5 text-blue-500"></i></div>
                            <div class="flex-1"><h4 class="font-bold text-sm tracking-tight">${opt.title}</h4><p class="text-[10px] opacity-30 font-bold tracking-widest uppercase">Exposure: 18</p></div>
                        </div>
                        <div class="grid grid-cols-3 gap-3">
                            <div class="bg-white/[0.02] p-3.5 rounded-2xl text-center"><p class="text-[9px] uppercase font-bold opacity-20">Time</p><p class="text-[13px] font-bold">${opt.segments[0].duration}m</p></div>
                            <div class="bg-white/[0.02] p-3.5 rounded-2xl text-center"><p class="text-[9px] uppercase font-bold opacity-20">Crowd</p><p class="text-[13px] font-bold ${opt.segments[0].crowd === 'High' ? 'text-red-400' : 'text-blue-500'}">${opt.segments[0].crowd}</p></div>
                            <div class="bg-white/[0.02] p-3.5 rounded-2xl text-center"><p class="text-[9px] uppercase font-bold opacity-20">Fare</p><p class="text-[13px] font-bold">₹${opt.cost}</p></div>
                        </div>
                        <div class="mt-5 p-4 bg-white/[0.02] rounded-2xl border border-white/5"><p class="text-[11px] opacity-40 leading-relaxed italic"><strong>Ranking Logic:</strong> ${opt.reason}</p></div>
                    </div>`).join('')}</div>`;
                initIcons();
            }, 1200);
        }

        function updateIntelligenceFromView(view) {
            const title = document.getElementById('intel-title');
            const body = document.getElementById('intel-body');
            if (!title || !body) return;
            if(view === 'map') { title.innerText = "Active Network Sync"; body.innerText = "Real-time load analysis enabled."; }
            else if(view === 'status') { title.innerText = "Stability Verified"; body.innerText = "Data stream latency: < 50ms."; }
            else if(view === 'planner') { title.innerText = "Optimal Ranking"; body.innerText = "Comparing comfort vs. velocity."; }
            initIcons();
        }

        function toggleTheme() {
            const body = document.body;
            const icons = [document.getElementById('theme-icon'), document.getElementById('theme-icon-nav')];
            if(body.classList.contains('dark-theme')) {
                body.classList.replace('dark-theme', 'light-theme');
                icons.forEach(i => i && i.setAttribute('data-lucide', 'sun'));
            } else {
                body.classList.replace('light-theme', 'dark-theme');
                icons.forEach(i => i && i.setAttribute('data-lucide', 'moon'));
            }
            initIcons();
        }
    </script>
</body>
</html>